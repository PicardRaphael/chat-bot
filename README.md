# ü§ñ Rapha√´l PICARD - AI Assistant

Un assistant IA personnel bas√© sur OpenAI GPT-4 et Gemini, avec une architecture modulaire et des fonctionnalit√©s avanc√©es d'√©valuation et de retry.

## üöÄ Fonctionnalit√©s

- üí¨ **Chat interactif** avec interface Gradio √©l√©gante
- üîÑ **Syst√®me de retry intelligent** avec strat√©gies multiples
- üìä **√âvaluation automatique** des r√©ponses avec Gemini
- üéØ **Profil personnalis√©** bas√© sur CV et informations LinkedIn
- ‚öôÔ∏è **Configuration flexible** via variables d'environnement
- üìà **Logging et m√©triques** pour monitoring
- üèóÔ∏è **Architecture modulaire** pour faciliter la maintenance

## üìã Pr√©requis

- Python 3.8+
- Cl√©s API OpenAI et Google (Gemini)
- Fichiers de profil (PDF LinkedIn, r√©sum√© texte)

## üõ†Ô∏è Installation

### 1. Cloner et naviguer

```bash
git clone git@github.com:PicardRaphael/chat-bot.git
cd chat-bot/
```

### 2. Installer les d√©pendances

```bash
pip install -r requirements.txt
```

### 3. Configuration des variables d'environnement

Cr√©er un fichier `.env` :

```bash
# API Keys (obligatoires)
OPENAI_API_KEY=sk-...
GOOGLE_API_KEY=...

# Configuration optionnelle
CHAT_MODEL=gpt-4o-mini
EVALUATION_MODEL=gemini-2.0-flash
PROFILE_DIR=raph/files
LOG_LEVEL=INFO
```

### 4. Pr√©parer les fichiers de profil

Placer dans le dossier `raph/files/` :

- `linkedin.pdf` : Export du profil LinkedIn en PDF
- `summary.txt` : R√©sum√© personnel en texte

## üöÄ Utilisation

### Interface simple

```bash
python main.py
```

### Interface avanc√©e avec onglets

```bash
python main.py --advanced
```

### Options de ligne de commande

```bash
python main.py --help

Options:
  --advanced    Interface avanc√©e avec configuration et m√©triques
  --share       Cr√©er un lien public Gradio
  --port 8080   Port personnalis√© (d√©faut: 7860)
  --host 0.0.0.0  Host personnalis√© (d√©faut: 127.0.0.1)
```

### Exemples d'utilisation

```bash
# Interface simple sur localhost
python main.py

# Interface avanc√©e avec partage public
python main.py --advanced --share

# Interface sur le r√©seau local, port 8080
python main.py --host 0.0.0.0 --port 8080
```

## üèóÔ∏è Architecture

### Structure du projet

```
raph/
‚îú‚îÄ‚îÄ üìÅ config/                 # Configuration
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ settings.py            # Variables d'environnement centralis√©es
‚îÇ   ‚îî‚îÄ‚îÄ prompts.py             # Templates de prompts
‚îú‚îÄ‚îÄ üìÅ core/                   # Logique m√©tier centrale
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ models.py              # Classes Pydantic (donn√©es structur√©es)
‚îÇ   ‚îú‚îÄ‚îÄ profile_loader.py      # Chargement des donn√©es de profil
‚îÇ   ‚îî‚îÄ‚îÄ message_formatter.py   # Formatage des messages OpenAI
‚îú‚îÄ‚îÄ üìÅ services/               # Services m√©tier
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ services/chat_service.py        # Service principal de chat
‚îÇ   ‚îú‚îÄ‚îÄ evaluation_service.py  # √âvaluation des r√©ponses
‚îÇ   ‚îî‚îÄ‚îÄ retry_service.py       # Strat√©gies de retry intelligentes
‚îú‚îÄ‚îÄ üìÅ api/                    # Clients API
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ openai_client.py       # Client OpenAI configur√©
‚îÇ   ‚îî‚îÄ‚îÄ gemini_client.py       # Client Gemini pour √©valuation
‚îú‚îÄ‚îÄ üìÅ ui/                     # Interface utilisateur
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ gradio_interface.py    # Interface Gradio compl√®te
‚îú‚îÄ‚îÄ üìÅ utils/                  # Utilitaires
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ file_utils.py          # Lecture de fichiers (PDF, texte)
‚îÇ   ‚îî‚îÄ‚îÄ logger.py              # Configuration des logs
‚îú‚îÄ‚îÄ üìÑ main.py                 # Point d'entr√©e principal
‚îú‚îÄ‚îÄ üìÑ requirements.txt        # D√©pendances Python
‚îú‚îÄ‚îÄ üìÑ test_tasks.py          # Tests de validation
‚îî‚îÄ‚îÄ üìÑ README.md              # Cette documentation
```

### Flux de donn√©es

```mermaid
graph TB
    A["üë§ Utilisateur"] --> B["üé® Gradio Interface"]
    B --> C["üí¨ Chat Service"]
    C --> D["üìù Message Formatter"]
    D --> E["ü§ñ OpenAI Client"]
    E --> F["üìä Evaluation Service"]
    F --> G["üîÑ Retry Service"]
    G --> H["‚ú® R√©ponse finale"]
    H --> B

    I["üìÅ Profile Loader"] --> C
    J["‚öôÔ∏è Settings"] --> C
    K["üìã Prompts"] --> C
    L["üóÉÔ∏è File Utils"] --> I
    M["üìä Logger"] --> C
```

## üß© Composants principaux

### üí¨ Chat Service

Service principal qui orchestre la g√©n√©ration de r√©ponses :

- Int√©gration avec le profil utilisateur
- Gestion des prompts syst√®me
- Pipeline complet : g√©n√©ration ‚Üí √©valuation ‚Üí retry si n√©cessaire

### üîÑ Retry Service

Syst√®me intelligent de retry avec plusieurs strat√©gies :

- **SINGLE** : Une seule tentative de retry
- **MULTIPLE** : Plusieurs tentatives avec √©valuation
- **PROGRESSIVE** : D√©lais progressifs entre tentatives
- **BEST_OF_N** : G√©n√®re N r√©ponses et s√©lectionne la meilleure

### üìä Evaluation Service

√âvaluation automatique des r√©ponses via Gemini :

- Crit√®res de qualit√© personnalisables
- Feedback d√©taill√© pour am√©lioration
- S√©lection automatique des meilleures r√©ponses

### üé® Gradio Interface

Interface utilisateur avec deux modes :

- **Simple** : Chat basique et √©pur√©
- **Avanc√©** : Onglets avec configuration et m√©triques

## ‚öôÔ∏è Configuration

### Variables d'environnement

| Variable            | Description                      | D√©faut             |
| ------------------- | -------------------------------- | ------------------ |
| `OPENAI_API_KEY`    | Cl√© API OpenAI                   | _(obligatoire)_    |
| `GOOGLE_API_KEY`    | Cl√© API Google                   | _(obligatoire)_    |
| `CHAT_MODEL`        | Mod√®le OpenAI pour le chat       | `gpt-4o-mini`      |
| `EVALUATION_MODEL`  | Mod√®le Gemini pour l'√©valuation  | `gemini-2.0-flash` |
| `PROFILE_DIR`       | Dossier des fichiers de profil   | `raph/files`       |
| `MAX_RETRIES`       | Nombre maximum de retry          | `3`                |
| `ENABLE_EVALUATION` | Activer l'√©valuation automatique | `True`             |
| `LOG_LEVEL`         | Niveau de logging                | `INFO`             |

### Fichiers de configuration

- `.env` : Variables d'environnement
- `config/settings.py` : Configuration centralis√©e
- `config/prompts.py` : Templates de prompts personnalisables

## üß™ Tests et validation

### Lancer les tests

```bash
python test_tasks.py
```

Les tests valident :

- ‚úÖ Configuration et chargement des settings
- ‚úÖ Fonctionnement des services (chat, √©valuation, retry)
- ‚úÖ Int√©gration des clients API
- ‚úÖ Interface Gradio
- ‚úÖ Formatage des messages
- ‚úÖ Chargement du profil

### Tests de performance

Les tests incluent la validation des m√©triques :

- Temps de r√©ponse
- Taux de succ√®s des retry
- Qualit√© des √©valuations

## üìä Monitoring et logs

### Structure des logs

```
2025-06-26 10:57:16 [INFO] raph_chatbot: üöÄ Starting: chat operation
2025-06-26 10:57:16 [INFO] raph_chatbot: ‚úÖ Completed: chat operation
```

### M√©triques disponibles

- **Temps de r√©ponse** moyen par requ√™te
- **Taux de succ√®s** des √©valuations
- **Nombre de retry** par conversation
- **Performance** des diff√©rents mod√®les

### Context managers pour le logging

```python
from utils.logger import LogContext, EvaluationLogContext

# Logging d'op√©ration
with LogContext("chat_generation"):
    response = generate_response(message)

# Logging d'√©valuation
with EvaluationLogContext("user_message", response, True):
    # √âvaluation automatiquement logg√©e
    pass
```

## üîß Personnalisation

### Ajouter un nouveau mod√®le

1. Modifier `config/settings.py` :

```python
CHAT_MODEL: str = "gpt-4o"  # Nouveau mod√®le
```

2. Red√©marrer l'application

### Personnaliser les prompts

Modifier `config/prompts.py` :

```python
SYSTEM_PROMPT = """
Vous √™tes un assistant personnalis√© pour {name}.
[Votre prompt personnalis√© ici]
"""
```

### Ajouter une nouvelle strat√©gie de retry

1. Modifier `services/retry_service.py`
2. Ajouter la strat√©gie dans `RetryStrategy` enum
3. Impl√©menter la logique dans `retry_with_strategy()`

## üêõ D√©pannage

### Probl√®mes courants

**Erreur "API key not found"**

- V√©rifier le fichier `.env`
- S'assurer que les cl√©s API sont valides

**Erreur "Profile files not found"**

- V√©rifier la pr√©sence de `linkedin.pdf` et `summary.txt` dans `raph/files/`
- Contr√¥ler le chemin dans `PROFILE_DIR`

**Interface Gradio ne d√©marre pas**

- V√©rifier que le port n'est pas d√©j√† utilis√©
- Essayer avec `--port 8080`

### Logs de d√©bogage

Activer le mode debug :

```bash
export LOG_LEVEL=DEBUG
python main.py
```

### Tests de connectivit√©

```python
from api.openai_client import get_openai_client
from api.gemini_client import get_gemini_client

# Test OpenAI
openai_client = get_openai_client()
print(openai_client.test_connection())

# Test Gemini
gemini_client = get_gemini_client()
print(gemini_client.test_connection())
```

## üöÄ D√©veloppement

### Ajouter une nouvelle fonctionnalit√©

1. **Service** : Cr√©er dans `services/`
2. **Mod√®les** : Ajouter dans `core/models.py`
3. **Tests** : Ajouter dans `test_tasks.py`
4. **Interface** : Modifier `ui/gradio_interface.py`

### Structure recommand√©e pour un nouveau service

```python
"""Module de description du service."""

from typing import Optional
from utils.logger import logger
from config.settings import settings

class MonService:
    """Description du service."""

    def __init__(self):
        """Initialisation."""
        self.setting = settings.MON_SETTING
        logger.debug("MonService initialized")

    def ma_methode(self) -> str:
        """Description de la m√©thode."""
        try:
            # Logique ici
            return "r√©sultat"
        except Exception as e:
            logger.error(f"Erreur dans ma_methode: {e}")
            raise

# Singleton pattern
_mon_service: Optional[MonService] = None

def get_mon_service() -> MonService:
    """Obtenir l'instance singleton."""
    global _mon_service
    if _mon_service is None:
        _mon_service = MonService()
    return _mon_service
```

## üìÑ Licence

Ce projet est un assistant personnel et n'est pas destin√© √† un usage commercial.

## üë§ Auteur

**Rapha√´l PICARD**

- Assistant IA personnel d√©velopp√© pour optimiser les interactions et fournir des r√©ponses contextuelles bas√©es sur le profil professionnel.

---

_Documentation g√©n√©r√©e automatiquement lors du refactoring - Phase 5 compl√®te_ ‚ú®
